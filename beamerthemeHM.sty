\ProvidesPackage{beamerthemeHM}[2025/10/12 HM Beamer Theme]

% Colors
\RequirePackage{xcolor}
\definecolor{HMRed}{HTML}{FB5454}
\definecolor{HMGray}{HTML}{E6E6E6}

% Basic beamer settings
\mode<presentation>
\setbeamercolor{structure}{fg=black}
\setbeamercolor{normal text}{fg=black,bg=white}
\setbeamercolor{title}{fg=black,bg=white}
\setbeamercolor{frametitle}{fg=black,bg=white}
\setbeamercolor{framesubtitle}{fg=HMRed}
\setbeamercolor{block title}{bg=HMGray,fg=black}
\setbeamercolor{block body}{bg=HMGray!60,fg=black}
\setbeamercolor{hmhighlight}{fg=white,bg=HMRed}

\setbeamertemplate{navigation symbols}{}

% Fonts: Helvetica as default sans
\RequirePackage[T1]{fontenc}
\RequirePackage[scaled]{helvet}
\renewcommand{\familydefault}{\sfdefault}

\setbeamerfont{frametitle}{series=\bfseries,size=\Large}
\setbeamerfont{framesubtitle}{series=\bfseries,size=\normalsize}
\setbeamerfont{hmhighlight}{series=\bfseries,size=\normalsize}
\setbeamerfont{footline}{size=\footnotesize}

% Customizable left-hand information on the title page
\newcommand{\hmleftinfotext}{}
\newcommand{\sethmleftinfo}[1]{\renewcommand{\hmleftinfotext}{#1}}

% Highlight banner per frame
\newcommand{\hmhighlighttext}{}
\newcommand{\hmframehighlight}[1]{\gdef\hmhighlighttext{#1}}

% Logo handling (user provides hm_logo.png or pdf in project root)
\newcommand{\hmlogopath}{hm_logo.png}
\newcommand{\sethmlogo}[1]{\renewcommand{\hmlogopath}{#1}}

% Footline: HM logo left, title & author center, frame numbers right
\makeatletter
\newcommand{\hm@footlinetext}{%
  \ifx\insertshorttitle\@empty
    \ifx\insertshortauthor\@empty
    \else
      \insertshortauthor
    \fi
  \else
    \insertshorttitle
    \ifx\insertshortauthor\@empty
    \else
      \ \textbullet\ \insertshortauthor
    \fi
  \fi
}
\makeatother
\setbeamercolor{footline}{fg=black,bg=white}
\setbeamertemplate{footline}{%
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=.16\paperwidth,ht=3.5ex,dp=1.5ex,left]{footline}%
      \hspace{1.25ex}\raisebox{-0.2ex}{\includegraphics[height=2.6ex]{\hmlogopath}}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.68\paperwidth,ht=3.5ex,dp=1.5ex,left]{footline}%
      \usebeamerfont{footline}\hm@footlinetext
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.16\paperwidth,ht=3.5ex,dp=1.5ex,right]{footline}%
      \usebeamerfont{footline}\insertframenumber{}
      \hspace{1.25ex}%
    \end{beamercolorbox}%
  }%
  \vskip0pt%
}

% Title page with big HM logo bottom-left and metadata blocks
\makeatletter
\setbeamertemplate{title page}{%
  \begin{minipage}[t]{0.48\paperwidth}
    \raggedright
    \vspace*{1.2em}%
    \small
    \ifx\hmleftinfotext\@empty
      \ifx\insertinstitute\@empty\else
        \insertinstitute\par
      \fi
      \ifx\insertauthor\@empty\else
        \vspace{1.2em}\insertauthor\par
      \fi
    \else
      \hmleftinfotext\par
    \fi
    \vfill
    \includegraphics[width=0.75\paperwidth]{\hmlogopath}
  \end{minipage}%
  \hfill
  \begin{minipage}[t]{0.45\paperwidth}
    \raggedleft
    \vspace*{1.2em}%
    {\usebeamerfont{title}\fontsize{26pt}{30pt}\selectfont\bfseries\inserttitle\par}
    \ifx\insertsubtitle\@empty\else
      \vspace{0.75em}{\usebeamercolor[fg]{framesubtitle}\usebeamerfont{framesubtitle}\insertsubtitle\par}
    \fi
    \ifx\insertdate\@empty\else
      \vspace{2em}{\normalsize\insertdate\par}
    \fi
  \end{minipage}%
}

% Frametitle with optional subtitle and highlight banner
\defbeamertemplate*{frametitle}{HM}{%
  \vspace{0.8em}%
  {\usebeamerfont{frametitle}\insertframetitle\par}
  \ifx\insertframesubtitle\@empty\else
    \vspace{0.25em}{\usebeamercolor[fg]{framesubtitle}\usebeamerfont{framesubtitle}\insertframesubtitle\par}
  \fi
  \ifx\hmhighlighttext\@empty\else
    \vspace{0.8em}%
    \begin{beamercolorbox}[wd=\textwidth,ht=3.2ex,dp=1.4ex,leftskip=1.5ex]{hmhighlight}
      {\usebeamerfont{hmhighlight}\hmhighlighttext}
    \end{beamercolorbox}
  \fi
  \vspace{0.6em}%
}
\addtobeamertemplate{frametitle}{\relax}{\gdef\hmhighlighttext{}}
\makeatother
\setbeamertemplate{frametitle}[HM]

% Itemize bullets in HM red
\setbeamercolor{item}{fg=HMRed}
\setbeamertemplate{itemize items}[circle]
\setbeamercolor{itemize item}{fg=HMRed}
\setbeamercolor{itemize subitem}{fg=HMRed}
\setbeamercolor{itemize subsubitem}{fg=HMRed}
