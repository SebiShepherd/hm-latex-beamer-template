\ProvidesPackage{beamerthemeHM}[2025/10/12 HM Beamer Theme]

% Colors
\RequirePackage{xcolor}
\definecolor{HMRed}{HTML}{FB5454}
\definecolor{HMGray}{HTML}{E6E6E6}

% Basic beamer settings
\mode<presentation>
\setbeamercolor{structure}{fg=black}
\setbeamercolor{normal text}{fg=black,bg=white}
\setbeamercolor{title}{fg=black,bg=white}
\setbeamercolor{frametitle}{fg=black,bg=white}
\setbeamercolor{block title}{bg=HMGray,fg=black}
\setbeamercolor{block body}{bg=HMGray!60,fg=black}

\setbeamertemplate{navigation symbols}{}

% Fonts: Helvetica as default sans
\RequirePackage[T1]{fontenc}
\RequirePackage[scaled]{helvet}
\renewcommand{\familydefault}{\sfdefault}

% TikZ for positioned title page elements
\RequirePackage{tikz}

% Custom commands for footer text
\newcommand{\hmfootertext}{}
\newcommand{\sethmfooter}[1]{\renewcommand{\hmfootertext}{#1}}

\makeatletter
\newcommand{\hmfootermiddle}{%
  \ifx\hmfootertext\@empty
    \insertshorttitle\,â€“\,\insertshortauthor
  \else
    \hmfootertext
  \fi}
\makeatother

% Logo handling (user provides hm_logo.png or pdf in project root)
\newcommand{\hmlogopath}{hm_logo.png}
\newcommand{\sethmlogo}[1]{\renewcommand{\hmlogopath}{#1}}

% Footline: HM logo left, custom text center, frame numbers right
\setbeamerfont{footline}{size=\small}
\setbeamercolor{footline}{fg=black,bg=white}

\setbeamertemplate{footline}{%
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=.18\paperwidth,ht=4.5ex,dp=2ex,leftskip=0.8em]{footline}%
      \raisebox{-0.2ex}{\includegraphics[height=0.9cm]{\hmlogopath}}%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.64\paperwidth,ht=4.5ex,dp=2ex,leftskip=0.3em]{footline}%
      \usebeamerfont{footline}\hmfootermiddle
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.18\paperwidth,ht=4.5ex,dp=2ex,rightskip=1em]{footline}%
      \usebeamerfont{footline}\insertframenumber{}
    \end{beamercolorbox}%
  }%
  \vskip0pt%
}

% Title page with big HM logo bottom-left
\makeatletter
\setbeamertemplate{title page}{%
  \begin{tikzpicture}[remember picture,overlay]
    \node[anchor=north west, text width=.42\paperwidth] at ([xshift=1.2cm,yshift=-1.6cm]current page.north west) {%
      \raggedright\fontsize{12pt}{15pt}\selectfont
      \insertinstitute\\[0.75em]
      \insertauthor
    };
    \node[anchor=north east, text width=.45\paperwidth] at ([xshift=-1.2cm,yshift=-1.6cm]current page.north east) {%
      \raggedleft\bfseries\fontsize{26pt}{30pt}\selectfont\inserttitle\par
      \ifx\insertsubtitle\@empty\else
        \vspace{0.3em}
        {\normalfont\fontsize{18pt}{22pt}\selectfont\insertsubtitle\par}
      \fi
      \vspace{1.5em}
      {\normalfont\fontsize{14pt}{18pt}\selectfont\insertdate\par}
    };
    \node[anchor=south west] at ([xshift=1.2cm,yshift=1.8cm]current page.south west) {%
      \includegraphics[width=.38\paperwidth]{\hmlogopath}
    };
  \end{tikzpicture}
}
\makeatother

% Itemize bullets in HM red
\setbeamercolor{item}{fg=HMRed}
\setbeamertemplate{itemize items}[circle]
\setbeamerfont{frametitle}{series=\bfseries,size=\Large}
\setbeamerfont{framesubtitle}{series=\bfseries,size=\normalsize}
\setbeamercolor{framesubtitle}{fg=HMRed}

\makeatletter
\setbeamertemplate{frametitle}{%
  \vbox{%
    \vspace{0.8em}%
    {\usebeamerfont{frametitle}\raggedright\insertframetitle\par}%
    \ifx\insertframesubtitle\@empty
    \else
      \vspace{0.2em}%
      {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\raggedright\insertframesubtitle\par}%
    \fi
    \vspace{0.6em}%
    {\color{HMRed}\rule{\textwidth}{1.6pt}}%
    \vspace{1.2em}%
  }%
}
\makeatother

\newcommand{\hmredbox}[1]{%
  \par\vspace{0.4em}%
  \colorbox{HMRed}{%
    \parbox{\dimexpr\linewidth-2\fboxsep\relax}{%
      \vspace{0.45em}%
      \raggedright\color{white}\bfseries #1\par
      \vspace{0.2em}%
    }%
  }%
  \par\vspace{1em}%
}
