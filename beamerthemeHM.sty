\ProvidesPackage{beamerthemeHM}[2025/10/12 HM Beamer Theme]

% Colors
\RequirePackage{xcolor}
\definecolor{HMRed}{HTML}{FB5454}
\definecolor{HMGray}{HTML}{E6E6E6}

% Basic beamer settings
\mode<presentation>
\setbeamercolor{structure}{fg=black}
\setbeamercolor{normal text}{fg=black,bg=white}
\setbeamercolor{title}{fg=black,bg=white}
\setbeamercolor{frametitle}{fg=black,bg=white}
\setbeamercolor{block title}{bg=HMGray,fg=black}
\setbeamercolor{block body}{bg=HMGray!60,fg=black}

\setbeamertemplate{navigation symbols}{}

% Fonts: Helvetica as default sans
\RequirePackage[T1]{fontenc}
\RequirePackage[scaled]{helvet}
\renewcommand{\familydefault}{\sfdefault}

% Custom commands for footer text
\newcommand{\hmfootertext}{}
\newcommand{\sethmfooter}[1]{\renewcommand{\hmfootertext}{#1}}

% Logo handling (user provides hm_logo.png or pdf in project root)
\newcommand{\hmlogopath}{hm_logo.png}
\newcommand{\sethmlogo}[1]{\renewcommand{\hmlogopath}{#1}}
% Separate footer logo (optional, defaults to main logo if not set)
% Usage: Uncomment the next line and replace the file name to override the footer logo
% \newcommand{\hmfooterlogopath}{hm_footer_logo.png}
% Provide a setter that works whether or not the macro was previously defined
\newcommand{\sethmfooterlogo}[1]{%
  \providecommand{\hmfooterlogopath}{}% define if not yet defined
  \renewcommand{\hmfooterlogopath}{#1}% then set to provided path
}
% Helper to get the effective footer logo path (fallback to main logo if not set)
\newcommand{\hmeffectivefooterlogo}{%
  \ifcsname hmfooterlogopath\endcsname
    \hmfooterlogopath
  \else
    \hmlogopath
  \fi
}
% Footer logo size on content slides (increase to enlarge the logo)
% Example: \sethmfooterlogoheight{3ex} or {8pt}
\newlength{\hmfooterlogoheight}\setlength{\hmfooterlogoheight}{2.6ex}
\newcommand{\sethmfooterlogoheight}[1]{\setlength{\hmfooterlogoheight}{#1}}

% Vertical fine-tuning for the footer logo only
% Positive values move the logo up, negative values move it down
% Example: \sethmfooterlogovshift{0.5ex}
\newlength{\hmfooterlogovshift}\setlength{\hmfooterlogovshift}{1ex}
\newcommand{\sethmfooterlogovshift}[1]{\setlength{\hmfooterlogovshift}{#1}}

% Footer padding (adjust to move content slightly inward)
\newlength{\hmfooterpadleft}\setlength{\hmfooterpadleft}{6mm}
\newlength{\hmfooterpadcenter}\setlength{\hmfooterpadcenter}{4mm}
\newlength{\hmfooterpadright}\setlength{\hmfooterpadright}{6mm}
% Spacing between logo and footer text ("regular" horizontal gap)
% Example: \sethmfooterlogotextsep{0.75em}
\newlength{\hmfooterlogotextsep}\setlength{\hmfooterlogotextsep}{1em}
\newcommand{\sethmfooterlogotextsep}[1]{\setlength{\hmfooterlogotextsep}{#1}}
% Width of the footer text block (so it can wrap to two lines)
% Example: \sethmfootertextwidth{0.60\paperwidth}
\newlength{\hmfootertextwidth}\setlength{\hmfootertextwidth}{0.60\paperwidth}
\newcommand{\sethmfootertextwidth}[1]{\setlength{\hmfootertextwidth}{#1}}

% Vertical fine-tuning for footer text (title + custom text) only
% Positive values move the text up, negative values move it down
% Example: \sethmfootertextvshift{0.5ex}
\newlength{\hmfootertextvshift}\setlength{\hmfootertextvshift}{1.5ex}
\newcommand{\sethmfootertextvshift}[1]{\setlength{\hmfootertextvshift}{#1}}

% Bottom padding: move footer content slightly up from the bottom edge
\newlength{\hmfooterpadbottom}\setlength{\hmfooterpadbottom}{4mm}
% Compute adjusted height/depth so total remains constant while adding bottom padding
\newlength{\hmfooterht}\setlength{\hmfooterht}{3ex}
\newlength{\hmfooterdp}\setlength{\hmfooterdp}{1ex}
\addtolength{\hmfooterdp}{\hmfooterpadbottom}
\addtolength{\hmfooterht}{-\hmfooterpadbottom}

% Footline: HM logo left + footer text, frame numbers right
\setbeamertemplate{footline}{%
  \leavevmode%
  \hbox{%
    % Left area (combined): logo + regular gap + footer text
    \begin{beamercolorbox}[wd=.82\paperwidth,ht=\hmfooterht,dp=\hmfooterdp,left]{footline}%
      % extra left padding to move logo slightly inwards
      \hspace{\hmfooterpadleft}%
  % footer logo (height configurable via \hmfooterlogoheight), vertically centered
  % Extra fine-tuning via \hmfooterlogovshift (positive = up, negative = down)
  \raisebox{\hmfooterlogovshift}{\raisebox{-.5\height}{\includegraphics[height=\hmfooterlogoheight]{\hmeffectivefooterlogo}}}%
      % regular separation between logo and text
      \hspace{\hmfooterlogotextsep}%
  % footer text block to the right of the logo (two lines), vertically centered with the logo
  % Line 1: presentation title (short title if set), Line 2: custom footer text
  % Styling: same font weight for both lines (no bold on title)
  % Extra fine-tuning via \hmfootertextvshift (positive = up, negative = down)
  \raisebox{\hmfootertextvshift}{\raisebox{-.5\height}{\parbox[c]{\hmfootertextwidth}{\usebeamerfont{footline}\footnotesize \insertshorttitle\\[-0.2ex] \hmfootertext}}}%
    \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.18\paperwidth,ht=\hmfooterht,dp=\hmfooterdp,right]{footline}%
      \usebeamerfont{footline}\footnotesize \insertframenumber{}%
      % extra right padding to move page number slightly inwards
      \hspace{\hmfooterpadright}
    \end{beamercolorbox}%
  }%
  \vskip0pt%
}

% Title page with big HM logo bottom-left
\setbeamertemplate{title page}{%
  \begingroup
  \vbox{}
  \vfill
  \begin{flushleft}
    {\usebeamercolor[fg]{title}\fontsize{22pt}{26pt}\selectfont\bfseries\inserttitle\par}
    \vspace{0.3em}
    {\usebeamercolor[fg]{title}\fontsize{16pt}{20pt}\selectfont\insertsubtitle\par}
    \vspace{1.5em}
    {\normalsize \insertauthor\par}
    {\normalsize \insertinstitute\par}
    \vspace{1em}
    {\normalsize \insertdate\par}
  \end{flushleft}
  \vfill
  \hbox to \textwidth{%
    \includegraphics[height=2.2cm]{\hmlogopath}\hfill
  }
  \endgroup
}

% Itemize bullets in HM red
\setbeamercolor{item}{fg=HMRed}
\setbeamertemplate{itemize items}[circle]
\setbeamerfont{frametitle}{series=\bfseries,size=\Large}